# 상세 기능 명세서 (Detailed Feature Specification)

_이 문서는 게임 기획서(GDD)의 주요 기능들에 대한 구체적인 구현 명세를 기술합니다. GDD와 함께 참고하여 개발을 진행합니다._

---

## 1. 게임 플레이 상세

- **코어 루프 상세:**
  1.  **미션 브리핑 (스토리 씬):**
      - 현재 에피소드의 스토리가 진행되며, 특정 시점에서 클라이언트(X)로부터 댓글 알바 미션 의뢰를 받는다.
      - 미션 목표(타겟 여론, 베스트 댓글 순위 등), 키워드, 조건, 제한 시간/기회 등이 제시된다. (UI: 대화창 또는 별도 미션 브리핑 UI)
      - 플레이어는 미션 수락/거절 선택지를 받을 수 있다 (선택적 기능). 수락 시 댓글알바 씬으로 이동.
  2.  **댓글 알바 수행 (댓글알바 씬):**
      - **UI:** 웹 브라우저 또는 온라인 커뮤니티 형태의 UI 표시.
      - **미션 정보 표시:** 화면 한 켠에 현재 미션 목표, 남은 시간/기회, 필수 키워드/조건 등을 상시 표시한다.
      - **여론 상태 표시:** 실시간으로 변동하는 긍정/부정/중립 여론 비율(%)을 그래프 또는 숫자로 표시한다.
      - **댓글 리스트:** AI가 생성한 초기 댓글(베스트 댓글 포함) 및 플레이어가 작성한 댓글이 시간순 또는 추천순으로 표시된다. 스크롤 기능 제공.
      - **댓글 입력:** 플레이어는 댓글 입력창에 직접 텍스트를 입력하고 '등록' 버튼을 누른다.
      - **댓글 작성 제한:** 미션에서 주어진 기회만큼 댓글을 작성할 수 있다. (기회 차감)
      - **시간 제한:** 미션에 제한 시간이 있다면, 타이머가 표시되고 시간이 다 되면 자동으로 결과 씬으로 이동한다.
      - **AI 반응 (Should Have):** 플레이어 댓글 등록 시, LLM이 해당 댓글을 평가하고 여론 수치를 업데이트하며, 새로운 AI 댓글(반응)을 생성하여 리스트에 추가한다. 베스트 댓글 순위도 변동될 수 있다.
  3.  **여론 변화 확인:** 플레이어는 댓글 작성 후 실시간으로 여론 상태 변화를 확인하며 다음 전략을 구상한다.
  4.  **(반복):** 제한 시간/기회가 소진될 때까지 2-3 단계를 반복한다.
  5.  **결과 확인 (결과 씬):**
      - 제한 시간/기회가 모두 소진되면 결과 씬으로 이동한다.
      - 미션 성공/실패 여부를 명확하게 텍스트와 시각 효과로 표시한다.
      - 달성한 여론 수치, 베스트 댓글 순위 등을 요약하여 보여준다.
      - **클라이언트 피드백 (Should Have):** LLM이 생성한 클라이언트의 평가 메시지(칭찬, 불만 등)를 표시한다.
      - 결과에 따라 다음 스토리 분기 또는 엔딩으로 이동하는 버튼을 제공한다.
  6.  **스토리 진행 (스토리 씬):** 미션 결과가 반영된 스토리가 진행된다. 성공 시 긍정적 전개, 실패 시 부정적 전개 또는 배드 엔딩 분기.
  7.  **엔딩:** 정해진 에피소드를 모두 완료하거나 특정 조건(배드 엔딩 조건 등)을 만족하면 해당 엔딩 씬으로 이동한다.
- **핵심 메카닉: 댓글 작성 및 여론 조작 상세:**
  - **댓글 입력:** 플레이어는 자유롭게 텍스트를 입력할 수 있다. (욕설 필터링 등 고려 필요)
  - **키워드/조건 체크 (Must Have):** 플레이어가 댓글 등록 시, 시스템은 해당 댓글이 미션에서 요구하는 키워드를 포함하는지, 특정 조건(예: 특정 인물 언급)을 만족하는지 판별한다.
  - **기본 여론 변화 (Must Have):** 키워드/조건 충족 여부에 따라 기본적인 여론 수치(긍정/부정/중립)가 증감한다. (예: 키워드 포함 시 긍정 +5%, 조건 미충족 시 변화 없음 등 단순 로직)
  - **상세 평가 시스템 (Should Have):** LLM을 사용하여 플레이어 댓글의 '영향력', '자연스러움', '주목도' 등을 점수화한다.
    - **영향력:** 댓글이 여론을 얼마나 크게 움직일 수 있는가? (키워드 활용도, 논리성 등 평가)
    - **자연스러움:** 댓글이 일반 사용자처럼 보이는가? (어투, 맥락 적합성 등 평가)
    - **주목도:** 댓글이 다른 사용자들의 시선을 끌 만한가? (자극성, 유머, 정보성 등 평가)
  - **상세 여론 변화 (Should Have):** 상세 평가 점수를 기반으로 여론 수치를 보다 복잡하고 현실적으로 변화시킨다. (예: 영향력 높고 자연스러우면 긍정 크게 증가, 부자연스러우면 오히려 반감 등)
  - **AI 댓글 생성 (Should Have):** 현재 여론 상태와 플레이어 댓글 내용을 바탕으로, LLM이 다양한 반응(동조, 반박, 무관심 등)의 AI 댓글을 생성하여 댓글 리스트에 추가한다.
  - **베스트 댓글 시스템 (Should Have):** 댓글 리스트 상단에 '좋아요' 또는 '추천' 수가 높은 베스트 댓글을 표시한다. 플레이어 댓글 및 AI 댓글 생성 결과에 따라 실시간으로 순위가 변동될 수 있다.

---

## 2. 게임 시스템 상세

- **LLM 기반 여론 시뮬레이션 시스템 상세:**
  - **댓글 분석/평가:**
    - (Must Have) 키워드/조건 포함 여부 판별 로직.
    - (Should Have) LLM 기반 상세 평가 (영향력, 자연스러움, 주목도) 로직. 프롬프트 설계가 중요하며, 일관된 평가 기준 유지가 필요하다. (TDD의 AI 통합 섹션 참조)
  - **여론 변화 로직:**
    - (Must Have) 기본 점수 기반 여론 증감 로직.
    - (Should Have) 상세 평가 점수 기반 복합 여론 변화 로직. 시간에 따른 자연 감소/증가 요소도 고려 가능.
  - **AI 댓글 생성:**
    - (Should Have) 현재 여론 상태, 최근 댓글(플레이어 댓글 포함), 미션 주제 등을 컨텍스트로 제공하여 LLM이 관련성 높고 다양한 톤의 댓글을 생성하도록 프롬프트 설계. (예: 긍정적 동조, 부정적 반박, 중립적 질문, 어그로 등)
  - **베스트 댓글 변화:**
    - (Should Have) 각 댓글(AI, 플레이어)에 가상의 '좋아요/싫어요' 수치를 부여하고, AI 댓글 생성 및 플레이어 댓글 평가 결과에 따라 수치를 변동시켜 베스트 댓글 순위를 동적으로 업데이트한다.
  - **클라이언트 피드백 생성:**
    - (Should Have) 미션 결과(성공/실패, 달성률 등)를 컨텍스트로 제공하여 LLM이 클라이언트의 말투와 성격에 맞는 피드백 메시지를 생성하도록 프롬프트 설계.
- **저장/불러오기 시스템 상세:**
  - (Must Have) 최소 1개 슬롯 지원. 게임 진행 상태(현재 스토리 ID, 완료된 미션, 현재 여론 상태 등 주요 변수)를 저장하고 로드할 수 있어야 한다. 저장 시점은 플레이어 선택 또는 특정 구간 자동 저장 방식 고려.
  - (Should Have) 4개 슬롯 지원. 각 슬롯별 저장 시간, 현재 에피소드/챕터 정보 등을 표시하여 플레이어가 쉽게 구분하도록 한다. 저장 데이터는 로컬 스토리지 또는 Electron 환경의 경우 파일 시스템 활용 고려.
- **언어 변경 시스템 상세:**
  - (Should Have) 게임 내 텍스트(UI, 대사, 미션 설명 등)를 다국어 JSON 또는 유사한 형태로 분리하여 관리한다. 설정 메뉴에서 언어(한국어, 영어, 중국어) 선택 시 해당 언어 데이터로 교체하여 표시한다. LLM 프롬프트도 선택된 언어에 맞게 조정 필요.
- **에피소드/미션 관리 시스템 상세:**
  - 에피소드 진행 방식(선형적, 분기 허용 등) 정의 필요.
  - 미션 데이터(JSON) 구조 정의: 미션 ID, 제목, 목표, 조건, 키워드, 제한 시간/기회, 초기 여론, 초기 댓글 목록, 관련 스토리 ID 등을 포함해야 한다.
  - 완료된 미션 상태를 추적하고, 다음 진행 가능한 에피소드/미션을 결정하는 로직 필요.

---

## 3. UI/UX 상세 (User Interface / User Experience)

_(모든 UI 요소는 시각 디자인 가이드(`document/visualStyleGuide.md`)에 정의된 **도트(Pixel Art) 스타일**을 따른다.)_

- **타이틀 씬 (`TitleScreen.tsx`):**
  - 게임 로고 (도트 스타일) 중앙 배치.
  - '시작하기', '불러오기', '설정', '종료' 버튼 (도트 스타일 `PixelButton`) 배치.
  - 배경 이미지 (도트 스타일).
- **스토리 씬 (`StoryScene.tsx`):**
  - **배경:** 현재 장면에 맞는 도트 배경 이미지 표시 (`Background.tsx`).
  - **캐릭터:** 현재 대사 중인 캐릭터 또는 장면에 등장하는 캐릭터의 도트 스프라이트 표시 (`Character.tsx`). 감정 변화에 따른 스프라이트 교체 기능.
  - **대화창 (`DialogueBox.tsx`):** 화면 하단 또는 중앙에 배치. 캐릭터 이름과 대사 텍스트(픽셀 폰트) 표시. 텍스트 타이핑 효과(선택적).
  - **독백창 (`MonologueBox.tsx`):** 주인공의 생각 등을 표시. 대화창과 시각적으로 구분되는 스타일.
  - **선택지 (`Choices.tsx`):** 스토리 분기점에서 선택지 버튼(도트 스타일) 목록 표시. 선택 시 시각적 피드백.
  - **시스템 메뉴:** 화면 구석(예: 우측 상단)에 설정 아이콘 버튼 배치. 클릭 시 설정 메뉴(`SettingsMenu.tsx`) 팝업.
- **댓글알바 씬 (`CommentScene.tsx`):**
  - **전체 레이아웃:** 웹 브라우저 또는 특정 커뮤니티 사이트 형태를 도트 스타일로 표현.
  - **미션 패널 (`MissionPanel.tsx`):** 화면 한 켠(예: 좌측 또는 우측 상단)에 고정 표시. 미션 목표, 남은 기회/시간, 키워드/조건 등 표시.
  - **여론 통계 (`OpinionStats.tsx`):** 긍정/부정/중립 비율을 도트 스타일 그래프(막대 또는 파이) 또는 숫자로 명확하게 표시. 실시간 업데이트 반영.
  - **댓글 리스트 (`CommentList.tsx`):** 스크롤 가능한 영역. 각 댓글은 컨테이너(도트 카드 스타일) 안에 사용자 이름, 내용, 시간, 추천/비추천 버튼(도트 아이콘) 포함. 베스트 댓글은 상단에 고정 또는 특별한 시각적 표시(예: 왕관 아이콘).
  - **댓글 입력 (`CommentInput.tsx`):** 화면 하단 또는 댓글 리스트 상/하단에 배치. 텍스트 입력 필드(도트 스타일)와 '등록' 버튼(도트 스타일). 남은 글자 수 표시(선택적).
- **결과 씬 (`ResultScene.tsx`):**
  - 미션 성공/실패 텍스트(크고 명확한 픽셀 폰트) 및 관련 도트 이미지/효과 표시.
  - 달성 결과 요약 (여론 수치, 순위 등) 텍스트 표시.
  - 클라이언트 피드백 메시지 표시 영역 (필요시 스크롤 가능).
  - '다음으로' 또는 '메인으로' 버튼 (도트 스타일).
- **설정 메뉴 (`SettingsMenu.tsx`):**
  - 팝업 형태 (도트 카드/창 스타일).
  - 볼륨 조절 슬라이더 (도트 스타일), 언어 선택 드롭다운/버튼 (도트 스타일), 저장/불러오기 버튼, 타이틀로 가기 버튼 등 포함.
- **저장/불러오기 화면:**
  - 슬롯 목록 (도트 카드 스타일). 각 슬롯에 저장 시간, 챕터 정보 등 표시.
  - '저장', '불러오기', '삭제' 버튼 제공. 확인 팝업(도트 스타일) 포함.
- **엔딩 씬:** 엔딩 내용(텍스트, 이미지)에 맞는 도트 그래픽 연출. 크레딧 롤(선택적).

---

## 4. 콘텐츠 상세

- **에피소드 구성 상세:**
  - 각 에피소드는 명확한 시작과 끝을 가지며, 특정 주제나 사건을 다룬다.
  - 에피소드 내 미션은 1개 이상 포함될 수 있다.
  - 에피소드 흐름: `[스토리 씬(인트로)] -> [댓글알바 씬(미션 수행)] -> [스토리 씬(결과 반영)] -> [결과 씬(미션 결과 요약)] -> [다음 에피소드 또는 분기]`
  - 에피소드 데이터 구조 정의 필요 (JSON 형식, 에피소드 ID, 제목, 관련 스토리 ID 목록, 포함된 미션 ID 목록 등).
- **미션 데이터 구조 상세 (`missions.json` 예시):**
  ```json
  [
    {
      "id": "mission_01",
      "title": "좋은 상품 [골드표 고양이 간식]을 추천하라",
      "targetOpinion": { "positive": 70 }, // 목표: 긍정 여론 70% 이상
      "targetBestCommentRank": 3, // 목표: 베스트 댓글 3위 안에 들기
      "keywords": ["골드표", "고양이 간식", "추천"], // 필수 포함 키워드
      "conditions": ["정바람 이미지 활용"], // 댓글 작성 시 고려 조건
      "initialOpinion": { "positive": 35, "negative": 55, "neutral": 10 },
      "maxAttempts": 2, // 최대 댓글 작성 기회
      "timeLimitSeconds": 180, // 제한 시간 (초, 0이면 무제한)
      "initialComments": [
        // 초기 댓글 목록 (AI 생성 또는 미리 작성)
        {
          "id": "cmt_001",
          "user": "냥집사",
          "text": "울 애기 이거 먹고 토했어요ㅠㅠ 비추",
          "likes": 85,
          "dislikes": 10,
          "isBest": true
        }
        // ... (베스트 댓글 및 일반 댓글 추가)
      ],
      "llmParams": {
        // LLM 평가/생성 관련 파라미터
        "likeRange": [10, 100],
        "dislikeRange": [5, 50],
        "evaluationCriteria": ["influence", "naturalness", "attention"] // 상세 평가 시 기준
      },
      "relatedStoryIds": {
        // 미션 전후 스토리 ID
        "briefing": "story_005",
        "success": "story_006_success",
        "failure": "story_006_failure"
      }
    }
    // ... (다른 미션 데이터)
  ]
  ```
- **스토리 스크립트 데이터 구조 상세 (`script.json` 예시):**
  ```json
  {
    "story_001": {
      "type": "dialogue", // 대화 타입
      "character": "주인공", // 화자
      "text": "하아... 오늘도 할 일이 태산이네.",
      "background": "bg_room_day", // 배경 이미지 ID
      "sprite": "char_player_idle", // 캐릭터 스프라이트 ID
      "next": "story_002" // 다음 스토리 ID
    },
    "story_002": {
      "type": "monologue", // 독백 타입
      "text": "(띵동! DTR Talk 알림이 울렸다.)",
      "next": "story_003"
    },
    "story_003": {
      "type": "dialogue",
      "character": "X", // 클라이언트 (이름은 X 또는 다른 가명)
      "sprite": "char_client_default", // 클라이언트 스프라이트 ID (실루엣 아님)
      "text": "새로운 '일감'이 들어왔네. 처리할 수 있겠나?",
      "next": "story_004"
    },
    "story_004": {
      "type": "choices", // 선택지 타입
      "text": "어떻게 할까?",
      "choices": [
        { "text": "네, 맡겨주세요.", "next": "story_005" }, // 미션 브리핑으로 연결
        {
          "text": "이번엔 좀 어려울 것 같은데요...",
          "next": "story_alternative_route"
        } // 다른 스토리 분기
      ]
    }
    // ... (미션 브리핑, 결과 반영 스토리 등 추가)
  }
  ```
- **향후 에피소드 아이디어:** (기존 내용 유지)

---
